<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0066)http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title> A Variety of Area Charts with R</title>
<meta name="generator" content="WordPress 3.8">  
<link rel="stylesheet" href="./A Variety of Area Charts with R_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://flowingdata.com/feed">
<link rel="pingback" href="http://flowingdata.com/xmlrpc.php">
<link rel="shortcut icon" href="http://flowingdata.com/wp-content/themes/flowingdata-4-8/images/favicon.ico">
<script src="./A Variety of Area Charts with R_files/quant.js" async="" type="text/javascript"></script><script async="" type="text/javascript" src="http://www.googletagservices.com/tag/js/gpt.js"></script><script type="text/javascript" src="./A Variety of Area Charts with R_files/jquery-1.4.4.min.js"></script>
<script type="text/javascript">
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    (function() {
    var gads = document.createElement('script');
    gads.async = true;
    gads.type = 'text/javascript';
    var useSSL = 'https:' == document.location.protocol;
    gads.src = (useSSL ? 'https:' : 'http:') + 
    '//www.googletagservices.com/tag/js/gpt.js';
    var node = document.getElementsByTagName('script')[0];
    node.parentNode.insertBefore(gads, node);
    })();
    </script>
<script type="text/javascript">
    googletag.cmd.push(function() {
    googletag.defineSlot('/2462688/Sidebar_rectangle', [300, 250], 'div-gpt-ad-1332011316310-2').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square1', [125, 125], 'div-gpt-ad-1332011316310-3').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square2', [125, 125], 'div-gpt-ad-1332011316310-4').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square3', [125, 125], 'div-gpt-ad-1332011316310-5').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square4', [125, 125], 'div-gpt-ad-1358209090048-5').addService(googletag.pubads());
googletag.defineSlot('/2462688/Bottom_Post', [300, 250], 'div-gpt-ad-1332011316310-0').addService(googletag.pubads());    googletag.pubads().enableSingleRequest();
    googletag.pubads().collapseEmptyDivs();
    googletag.enableServices();
    });
    </script>
<link rel="alternate" type="application/rss+xml" title="FlowingData » A Variety of Area Charts with R Comments Feed" href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/feed/">
<script type="text/javascript" src="./A Variety of Area Charts with R_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./A Variety of Area Charts with R_files/jquery.js"></script>
<script type="text/javascript" src="./A Variety of Area Charts with R_files/jquery-migrate.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://flowingdata.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://flowingdata.com/wp-includes/wlwmanifest.xml">
<link rel="prev" title="How long it takes to get pregnant" href="http://flowingdata.com/2012/07/03/how-long-it-takes-to-get-pregnant/">
<link rel="next" title="Huffington Post Pollster API" href="http://flowingdata.com/2012/07/03/huffington-post-pollster-api/">
<meta name="generator" content="WordPress 3.8">
<link rel="canonical" href="./A Variety of Area Charts with R_files/A Variety of Area Charts with R.html">
<link rel="shortlink" href="http://flowingdata.com/?p=25515">
 <script type="text/javascript" src="./A Variety of Area Charts with R_files/democracy.js"></script><link rel="stylesheet" href="./A Variety of Area Charts with R_files/basic.css" type="text/css"><link rel="stylesheet" href="./A Variety of Area Charts with R_files/style(1).css" type="text/css"><link rel="stylesheet" href="./A Variety of Area Charts with R_files/wp-page-numbers.css" type="text/css" media="screen"><style type="text/css">img#wpstats{display:none}</style><link rel="stylesheet" type="text/css" href="./A Variety of Area Charts with R_files/shCore.css"><link rel="stylesheet" type="text/css" href="./A Variety of Area Charts with R_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
<style>#fninvidxrbynahoesttiqjztzcmimsiaxfqvxmrudi{border:solid 2px #fff !important;box-sizing:content-box !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-webkit-border-radius:5px !important;-webkit-box-shadow:0px 0px 20px #000 !important;-webkit-box-sizing:content-box !important;}.fninvidxrbynahoesttiqjztzcmimsiaxfqvxmrudi-blocked{color:#777 !important;display:inline !important;text-decoration:line-through !important;}#fninvidxrbynahoesttiqjztzcmimsiaxfqvxmrudi br{display:block !important;}#fninvidxrbynahoesttiqjztzcmimsiaxfqvxmrudi span{background:transparent !important;}#fninvidxrbynahoesttiqjztzcmimsiaxfqvxmrudi div{border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#fninvidxrbynahoesttiqjztzcmimsiaxfqvxmrudi a{font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}@media print{#fninvidxrbynahoesttiqjztzcmimsiaxfqvxmrudi{display:none !important;}}</style></head>
<body style="">
<a name="top"></a>
<div id="topnav">
<div id="topnav-content" class="content">
<div id="login" class="float-right">
<span id="username-meta">Logged in as <a href="http://flowingdata.com/profile/">abresler</a> &nbsp;&nbsp;</span>
<a href="http://flowingdata.com/wp-login.php?action=logout&_wpnonce=d018091d15">Log out</a> </div>
</div>
<div class="clear-line"></div>
</div> 
<div id="header">
<div id="header-content" class="content">
<div id="nav">
<a href="http://flowingdata.com/">
<img src="./A Variety of Area Charts with R_files/logo.png" class="float-left" scale="0">
</a>
<div id="pages" class="float-right">
<ul>
<li><a href="http://flowingdata.com/membership/">Membership</a></li>
<li><a href="http://flowingdata.com/learning/">Learning</a></li>
<li><a href="https://jobs.flowingdata.com/">Job Board</a></li>
<li><a href="http://flowingdata.com/category/projects/">Projects</a></li>
<li><a href="http://flowingdata.com/about/">About</a></li>
</ul>
</div> 
<div class="clear-line"></div>
</div> 
</div> 
</div> 
<div class="clear-line"></div>
<div id="main-wrapper">
<div id="content-wrapper" class="content">
<div class="post" id="post-25515">
<div id="content" class="single-long">
<div class="entry">
<div class="category">
<a href="http://flowingdata.com/category/tutorials/" title="View all posts in Tutorials" rel="category tag">Tutorials</a> &nbsp;/&nbsp; <a href="http://flowingdata.com/tag/area-chart/" rel="tag">area chart</a>, <a href="http://flowingdata.com/tag/r/" rel="tag">R</a>, <a href="http://flowingdata.com/tag/streamgraph/" rel="tag">streamgraph</a> <span class="members-note"><a href="http://flowingdata.com/members-only">Members Only</a></span> </div>
<h1>A Variety of Area Charts with R</h1>
<div class="clear-line"></div>
<div class="author">
By <strong>Nathan Yau</strong>
</div> 
<div id="lead-in">
<p class="img-right"><img src="./A Variety of Area Charts with R_files/featured-image1.png" class="attachment-long-form-thumb wp-post-image" alt="From Area Chart to Streamgraph" width="425" height="303" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/07/featured-image1.png?fit=425%2C9999" scale="2"></p>
<div class="entry-excerpt">
From the basic area chart, to the stacked version, to the streamgraph, the geometry is similar. Once you know how to do one, you can do them all. </div>
<div id="tut-meta">
<div class="button-link"><a href="http://flowingdata.com/wp-content/uploads/2012/07/Streaming-large.png">Demo</a></div>
<div class="button-link"><a href="http://flowingdata.com/?s2member_file_download=2012/streamgraph-tutorial.zip">Download Source</a></div>
<div class="clear-line"></div>
</div> 
<div class="clear-line"></div>
</div> 
<div class="entry-content">
<p>Back in 2008, <em>The New York Times</em>, with the help of Lee Byron, <a href="http://flowingdata.com/2008/02/25/ebb-and-flow-of-box-office-receipts-over-past-20-years/">published a streamgraph</a> that showed the ebb and flow of box office receipts. The graphic was based on Byron's previous work with <a href="http://www.leebyron.com/what/lastfm/">last.fm listening habits</a>, and it was well-received by many, while others argued that it was not as accurate as it could be. Byron, along with Martin Wattenberg, later <a href="http://www.leebyron.com/else/streamgraph/">argued in their paper</a> that while some accuracy is sacrificed, the balance of aesthetics and traditional chart-making make for a worthwhile chart.</p>
<p><span class="tip">For use of the function, skip down to the bottom or check out sampleusage.R in the download.</span>In this tutorial you learn what goes into the streamgraph and end up with a simple function that you can easily use with other datasets.</p>
<h2>Setup</h2>
<p>As per usual, <a href="http://www.r-project.org/">download and install R</a> if you haven't already. It's the statistician's statistical computing language of choice. It's free, it's open source, and you can do a lot with it. Plus, it's improving and becoming more widely recognized every day.</p>
<p>It's worth downloading the code for this tutorial to follow along, but you can of course copy and paste too.</p>
<p>Open R, and you should see something like this. It's called the R console.</p>
<p><span class="tip">R console where you type commands and stuff</span><img src="./A Variety of Area Charts with R_files/R-Console.png" alt="" title="R Console" class="alignnone size-medium wp-image-25558" width="625" height="506" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2012/07/R-Console.png?resize=625%2C506" scale="2"></p>
<h2>The Data</h2>
<p><span class="tip">I know, I know, it's better to work with real data. You'll get there later.</span>To begin, create some fake data. The code below creates a data frame with several rows (i.e. layers) of random data.</p>
<div id="highlighter_87108" class="syntaxhighlighter  "><div class="bar  show"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_87108_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_87108" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Frake data frame</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">numCols &lt;- 20</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">numLayers &lt;- 5</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">fakeData &lt;- </code><code class="functions">data.frame</code><code class="plain">(</code><code class="functions">matrix</code><code class="plain">(ncol=numCols, nrow=numLayers))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:numLayers) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">heights &lt;- 1 / </code><code class="functions">runif</code><code class="plain">(numCols, 0, 1)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">newRow &lt;- heights * </code><code class="functions">exp</code><code class="plain">(-heights * heights)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">fakeData[i,] &lt;- newRow</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Type <code>fakeData</code> to take a gander at what the data frame looks like.</p>
<h2>Area Chart</h2>
<p>If you're familiar with <a href="http://flowingdata.com/2012/06/05/how-to-draw-in-r-and-make-custom-plots/">custom charts in R</a>, making a single layer stacked area chart is straightforward. Make a blank plot window with <code>plot()</code> and then use <code>polygon()</code> to draw the same of the chart. When you use <code>polygon()</code> you start at a x- and y-coordinate and then follow with other points in the order you want to draw the line. End with the point you started at. Specify the fill color with the <code>col</code> argument.</p>
<div id="highlighter_553167" class="syntaxhighlighter  "><div class="bar   "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_553167_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_553167" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Regular area chart, zero offset, one layer</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="comments"># Blank plot window</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">plot</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), 1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), ylim=</code><code class="functions">c</code><code class="plain">(0, </code><code class="functions">max</code><code class="plain">(fakeData[1,])), xlab=</code><code class="keyword">NA</code><code class="plain">, ylab=</code><code class="keyword">NA</code><code class="plain">, type=</code><code class="string">"n"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="comments"># Draw area</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="functions">polygon</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), </code><code class="functions">length</code><code class="plain">(fakeData[1,]):1), </code><code class="functions">c</code><code class="plain">(fakeData[1,], </code><code class="functions">rep</code><code class="plain">(0, </code><code class="functions">length</code><code class="plain">(fakeData[1,]))), col=</code><code class="string">"#cccccc"</code><code class="plain">, border=</code><code class="string">"white"</code><code class="plain">)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>You get an area chart of the first layer in the <code>fakeData</code> data frame.</p>
<p><span class="tip">Basic area chart with one layer</span><img src="./A Variety of Area Charts with R_files/00Area-Chart.png" alt="" title="Area Chart" class="alignnone size-medium wp-image-25531" width="625" height="313" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/07/00Area-Chart.png?resize=625%2C313" scale="2"></p>
<h2>Stacked Area Chart</h2>
<p>A stacked area chart follows similar logic, except you have to iterate through each layer. You draw the first layer the same way that you did previously, but you have to keep track of how high each layer goes at each x-value. This is the purpose of the <code>yOffset</code> vector. Initially, it's at all zeros, and then after you place the first layer the offsets increase, so the base of the next layer is drawn on top of the previous instead of on the horizontal axis.</p>
<div id="highlighter_946589" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_946589_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_946589" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Stacked area, zero offset</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">totals &lt;- </code><code class="functions">colSums</code><code class="plain">(fakeData)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">plot</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), 1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), type=</code><code class="string">"n"</code><code class="plain">, ylim=</code><code class="functions">c</code><code class="plain">(0, </code><code class="functions">max</code><code class="plain">(totals)), xlab=</code><code class="keyword">NA</code><code class="plain">, ylab=</code><code class="keyword">NA</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">yOffset &lt;- </code><code class="functions">rep</code><code class="plain">(0, </code><code class="functions">length</code><code class="plain">(fakeData[1,]))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(fakeData[,1])) { </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">polygon</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(fakeData[i,]), </code><code class="functions">length</code><code class="plain">(fakeData[i,]):1), </code><code class="functions">c</code><code class="plain">(fakeData[i,] + yOffset, </code><code class="functions">rev</code><code class="plain">(yOffset)), col=</code><code class="string">"#cccccc"</code><code class="plain">, border=</code><code class="string">"white"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">yOffset &lt;- yOffset + fakeData[i,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>This is what the stacked area chart looks like. It's not all that pretty, yet.</p>
<p><span class="tip">Stacked area chart, which shows multiple layers</span><img src="./A Variety of Area Charts with R_files/01stacked-area-chart.png" alt="" title="Stacked area chart" class="alignnone size-medium wp-image-25518" width="625" height="331" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2012/07/01stacked-area-chart.png?resize=625%2C331" scale="2"></p>
<h2>ThemeRiver</h2>
<p>Back to the <code>yOffset</code> — the bottom of the first layer of the stacked area chart. That was initialized at zero, so the graph is flat on the bottom, but what if you shifted the baseline of the first layer down? The layers that you put on top of it would also shift down and the graph as a whole would change shape.</p>
<p>For example, you could center the entire graph on the horizontal axis so that half the of the cart is below zero and the other half above. To do that you need the column totals at each x-value, and shift halfway down. That's the <code>yOffset</code>, and actually what ThemeRiver by Susan Havre and company.</p>
<div id="highlighter_991920" class="syntaxhighlighter  "><div class="bar  "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_991920_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_991920" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Stacked area, centered offset (ThemeRiver)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">totals &lt;- </code><code class="functions">colSums</code><code class="plain">(fakeData)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">yOffset &lt;- -totals / 2</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">maxSum &lt;- </code><code class="functions">max</code><code class="plain">(totals)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">plot</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), 1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), type=</code><code class="string">"n"</code><code class="plain">, ylim=</code><code class="functions">c</code><code class="plain">(-maxSum/2, maxSum/2), xlab=</code><code class="keyword">NA</code><code class="plain">, ylab=</code><code class="keyword">NA</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(fakeData[,1])) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">polygon</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), </code><code class="functions">length</code><code class="plain">(fakeData[1,]):1), </code><code class="functions">c</code><code class="plain">(fakeData[i,] + yOffset, </code><code class="functions">rev</code><code class="plain">(yOffset)), col=</code><code class="string">"#cccccc"</code><code class="plain">, border=</code><code class="string">"white"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">yOffset &lt;- yOffset + fakeData[i,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>The layers are stacked in the same way as in the stacked area chart, but how the whole thing is centered vertically.</p>
<p><span class="tip">ThemeRiver, uses a midpoint offset so that graph is centered on zero-axis</span><img src="./A Variety of Area Charts with R_files/02ThemeRiver.png" alt="" title="ThemeRiver" class="alignnone size-medium wp-image-25520" width="625" height="328" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/07/02ThemeRiver.png?resize=625%2C328" scale="2"></p>
<h2>Reducing Wiggle</h2>
<p><span class="tip">Read the paper by Byron and Wattenberg for more details on the math behind the wiggle reduction.</span>The challenge though is that when you have a lot of layers, the chart quickly grows harder to read. You end up with a bunch of wiggles. Even in the above, which only has five layers, is kind of confusing. Byron worked on minimizing the amount of wiggle by optimizing the vertical offset and finding the best layer sorting. First the former.</p>
<div id="highlighter_487285" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_487285_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_487285" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Reduced wiggle, no sorting.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">n &lt;- </code><code class="functions">length</code><code class="plain">(fakeData[,1])</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">i &lt;- 1:</code><code class="functions">length</code><code class="plain">(fakeData[,1])</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">parts &lt;- (n - i + 1) * fakeData</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">theSums &lt;- </code><code class="functions">colSums</code><code class="plain">(parts)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">totals &lt;- </code><code class="functions">colSums</code><code class="plain">(fakeData)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="plain">maxSum &lt;- </code><code class="functions">max</code><code class="plain">(totals)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">yOffset &lt;- -theSums / (n + 1)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="plain">yLower &lt;- </code><code class="functions">min</code><code class="plain">(yOffset)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="plain">yUpper &lt;- </code><code class="functions">max</code><code class="plain">(yOffset + totals)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Once the <code>yOffset</code> is found, the plotting is the same as before.</p>
<div id="highlighter_237475" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_237475_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_237475" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">plot</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), 1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), type=</code><code class="string">"n"</code><code class="plain">, ylim=</code><code class="functions">c</code><code class="plain">(yLower, yUpper), xlab=</code><code class="keyword">NA</code><code class="plain">, ylab=</code><code class="keyword">NA</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(fakeData[,1])) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">polygon</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(fakeData[1,]), </code><code class="functions">length</code><code class="plain">(fakeData[1,]):1), </code><code class="functions">c</code><code class="plain">(fakeData[i,] + yOffset, </code><code class="functions">rev</code><code class="plain">(yOffset)), col=</code><code class="string">"#cccccc"</code><code class="plain">, border=</code><code class="string">"white"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">yOffset &lt;- yOffset + fakeData[i,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Notice the plot looks similar to the ThemeRiver layout, but the amount of ups and down is reduced and the layers aren't all centered at the vertical midpoint.</p>
<p><span class="tip">Reducing the amount of wiggle, enroute to a streamgraph</span><img src="./A Variety of Area Charts with R_files/03Reduced-wiggle.png" alt="" title="Reduced wiggle" class="alignnone size-medium wp-image-25521" width="625" height="326" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2012/07/03Reduced-wiggle.png?resize=625%2C326" scale="2"></p>
<p>It looks better, but there's more that can be done with sorting so that the layer placement doesn't look so random. The naive way to sort the layers would simply be to alternate from to bottom but can be problematic when values are not perfectly balanced. The chart could end up straying up or down. </p>
<h2>Sorting the Layers</h2>
<p>The sorting proposed by Byron and Wattenberg is one that weights each layer by the sum of all its values and then stacks based on the current total weight of layers already drawn. So you start in the middle with the first layer, and add one layer at a time. If the top half of the chart is "heavier" than the bottom, add the next layer to the bottom, and vice versa.</p>
<p>Okay, so first get the weights.</p>
<div id="highlighter_471482" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_471482_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_471482" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Reduced wiggle, sorted by layer weight.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">sortedData &lt;- fakeData[1,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">weights &lt;- </code><code class="functions">rowSums</code><code class="plain">(fakeData)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">topWeight &lt;- weights[1]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">bottomWeight &lt;- weights[1]</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Then iterate through each row to figure out the sorting. You're not drawing yet. Rather you're creating a new sorted data frame.</p>
<div id="highlighter_444440" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_444440_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_444440" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">2:</code><code class="functions">length</code><code class="plain">(fakeData[,1])) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">if </code><code class="plain">(topWeight &gt; bottomWeight) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sortedData &lt;- </code><code class="functions">rbind</code><code class="plain">(sortedData, fakeData[i,])</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">topWeight &lt;- topWeight + weights[i]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sortedData &lt;- </code><code class="functions">rbind</code><code class="plain">(fakeData[i,], sortedData)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">bottomWeight &lt;- bottomWeight + weights[i]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Now you have have sorted data frame. Like before, you want to reduce wiggle and calculate the vertical offset.</p>
<div id="highlighter_154989" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_154989_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_154989" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">n &lt;- </code><code class="functions">length</code><code class="plain">(sortedData[,1])</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">i &lt;- 1:</code><code class="functions">length</code><code class="plain">(sortedData[,1])</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">parts &lt;- (n - i + 1) * sortedData</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">theSums &lt;- </code><code class="functions">colSums</code><code class="plain">(parts)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">totals &lt;- </code><code class="functions">colSums</code><code class="plain">(sortedData)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">yOffset &lt;- -theSums / (n + 1)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="plain">yLower &lt;- </code><code class="functions">min</code><code class="plain">(yOffset)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="plain">yUpper &lt;- </code><code class="functions">max</code><code class="plain">(yOffset + totals)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>You will also incorporate color at this point. The heavier the layer, the darker it will be. So you need to know the span of the weights.</p>
<div id="highlighter_137792" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_137792_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_137792" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">maxRow &lt;- </code><code class="functions">max</code><code class="plain">(</code><code class="functions">rowSums</code><code class="plain">(sortedData))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">minRow &lt;- </code><code class="functions">min</code><code class="plain">(</code><code class="functions">rowSums</code><code class="plain">(sortedData))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">rowSpan &lt;- maxRow - minRow</code></td></tr></tbody></table></div></div></div>
<p></p>
<p><span class="tip">See the <a href="http://flowingdata.com/2012/01/19/using-color-scales-and-palettes-in-r/">color tutorial</a> for more on palettes.</span>And create a color palette, in this example it is one from blue to white.</p>
<div id="highlighter_822613" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_822613_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_822613" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Color palette</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">nColors &lt;- 10</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">pal &lt;- </code><code class="functions">colorRampPalette</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(</code><code class="string">"#0f7fb4"</code><code class="plain">, </code><code class="string">"white"</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">colors &lt;- </code><code class="functions">pal</code><code class="plain">(nColors)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>With calculations done, plotting is the same as before, except this time you're bringing in color.</p>
<div id="highlighter_432303" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_432303_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_432303" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">plot</code><code class="plain">(1:10, 1:10, type=</code><code class="string">"n"</code><code class="plain">, xlim=</code><code class="functions">c</code><code class="plain">(1, numcols), ylim=</code><code class="functions">c</code><code class="plain">(yLower, yUpper), xlab=</code><code class="keyword">NA</code><code class="plain">, ylab=</code><code class="keyword">NA</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(sortedData[,1])) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># Determine color.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">colindex &lt;- </code><code class="functions">floor</code><code class="plain">( (nColors-2) * ( (maxRow - </code><code class="functions">sum</code><code class="plain">(sortedData[i,])) / rowSpan ) ) + 1</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># Draw shape.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">polygon</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(sortedData[i,]), </code><code class="functions">length</code><code class="plain">(sortedData[i,]):1), </code><code class="functions">c</code><code class="plain">(sortedData[i,] + yOffset, </code><code class="functions">rev</code><code class="plain">(yOffset)), col=colors[colindex], border=</code><code class="string">"white"</code><code class="plain">, lwd=0.2)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">yOffset &lt;- yOffset + sortedData[i,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>This thing is starting to take shape, yeah?</p>
<p><span class="tip">Reduced wiggle, sorting, and with color ala streamgraph</span><img src="./A Variety of Area Charts with R_files/04Reduced-wiggle-with-color.png" alt="" title="Reduced wiggle with color" class="alignnone size-full wp-image-25522" width="625" height="327" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/07/04Reduced-wiggle-with-color.png?resize=625%2C327" scale="2"></p>
<h2>Streamgraph</h2>
<p>You can do more though. When you think streamgraphs, you think smooth layers, not jagged ones. So let's rewind. Sort the data according to weights.</p>
<div id="highlighter_587924" class="syntaxhighlighter  "><div class="bar   "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_587924_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_587924" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">sortedData &lt;- fakeData[1,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">weights &lt;- </code><code class="functions">rowSums</code><code class="plain">(fakeData)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">topWeight &lt;- weights[1]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">bottomWeight &lt;- weights[1]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="functions">if </code><code class="plain">(</code><code class="functions">length</code><code class="plain">(fakeData[,1]) &gt; 1) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">2:</code><code class="functions">length</code><code class="plain">(fakeData[,1])) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">if </code><code class="plain">(topWeight &gt; bottomWeight) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sortedData &lt;- </code><code class="functions">rbind</code><code class="plain">(sortedData, fakeData[i,])</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">topWeight &lt;- topWeight + weights[i]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sortedData &lt;- </code><code class="functions">rbind</code><code class="plain">(fakeData[i,], sortedData)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">bottomWeight &lt;- bottomWeight + weights[i]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Okay, you've done that before.</p>
<p>Here's a helper function that you need in the next step. It takes a value <code>x</code>, and if it's negative, it returns zero. Otherwise, the function returns the original value.</p>
<div id="highlighter_203572" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_203572_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_203572" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">zeroNegatives &lt;- </code><code class="keyword">function</code><code class="plain">(x) { </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">if </code><code class="plain">(x &lt; 0) { </code><code class="functions">return</code><code class="plain">(0) }</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">else</code> <code class="plain">{ </code><code class="functions">return</code><code class="plain">(x) }</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Back to smooth. R provides a function called <code>spline()</code> which takes in points, and it returns a new set of points that makes a smooth curve through the original points. Wikipedia provides you with a more complete description, but basically spline is a piecewise function that fits to a set of points for one continuous line.</p>
<p>You use <code>spline()</code> on the sorted data, and then iterate through each row. Create a new data frame in the process to store the smoothed data. </p>
<p><span class="tip">Okay, technically speaking you can stack negative values, but that makes sorting and drawing more complicated.</span>The <code>zeroNegatives()</code> function is applied to each value with <code>sapply</code>, because the <code>spline()</code> function outputs some negative values. However, the values in the streamgraph have to be positive. You can't stack negative values.</p>
<div id="highlighter_952943" class="syntaxhighlighter  "><div class="bar   "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_952943_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_952943" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Initialize smoothed data</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">firstRow &lt;- </code><code class="functions">spline</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(sortedData[1,]), sortedData[1,], 200)$y</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">firstRow &lt;- </code><code class="functions">sapply</code><code class="plain">(firstRow, zeroNegatives)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">smoothData &lt;- </code><code class="functions">data.frame</code><code class="plain">( </code><code class="functions">rbind</code><code class="plain">(firstRow, </code><code class="functions">rep</code><code class="plain">(0, </code><code class="functions">length</code><code class="plain">(firstRow))) )</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">smoothData &lt;- smoothData[1,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="functions">if </code><code class="plain">(</code><code class="functions">length</code><code class="plain">(sortedData[,1]) &gt; 1) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">2:</code><code class="functions">length</code><code class="plain">(sortedData[,1])) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">splinerow &lt;- </code><code class="functions">spline</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(sortedData[i,]), sortedData[i,], 200)$y</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">splinerow &lt;- </code><code class="functions">sapply</code><code class="plain">(splinerow, zeroNegatives)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">smoothData &lt;- </code><code class="functions">rbind</code><code class="plain">(smoothData, splinerow)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>The rest of the steps are just like before. First find the optimal <code>yOffset</code>.</p>
<div id="highlighter_163989" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_163989_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_163989" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Optimize vertical offset</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">n &lt;- </code><code class="functions">length</code><code class="plain">(smoothData[,1])</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">i &lt;- 1:</code><code class="functions">length</code><code class="plain">(smoothData[,1])</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">parts &lt;- (n - i + 1) * smoothData</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">theSums &lt;- </code><code class="functions">colSums</code><code class="plain">(parts)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">yOffset &lt;- -theSums / (n + 1)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Get the upper and lower bounds for the plot window and the minimum and maximum so you can decide what color to use for each layer.</p>
<div id="highlighter_785646" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_785646_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_785646" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Totals at each index for axis upper and lower bounds</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">totals &lt;- </code><code class="functions">colSums</code><code class="plain">(smoothData)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">yLower &lt;- </code><code class="functions">min</code><code class="plain">(yOffset)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">yUpper &lt;- </code><code class="functions">max</code><code class="plain">(yOffset + totals)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="comments"># Max, min, and span of weights for each layer</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="plain">maxRow &lt;- </code><code class="functions">max</code><code class="plain">(</code><code class="functions">rowSums</code><code class="plain">(smoothData))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="plain">minRow &lt;- </code><code class="functions">min</code><code class="plain">(</code><code class="functions">rowSums</code><code class="plain">(smoothData))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">rowSpan &lt;- </code><code class="functions">if </code><code class="plain">( (maxRow - minRow) &gt; 0 ) { maxRow - minRow } </code><code class="keyword">else</code> <code class="plain">{ 1 }</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Then make the streamgraph, iterating through each row of <code>smoothData</code> and using <code>polygon()</code> to draw.</p>
<div id="highlighter_128244" class="syntaxhighlighter  "><div class="bar   "><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_128244_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_128244" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Make the graph.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">plot</code><code class="plain">(1:10, 1:10, type=</code><code class="string">"n"</code><code class="plain">, xlim=</code><code class="functions">c</code><code class="plain">(1, </code><code class="functions">length</code><code class="plain">(smoothData[1,])), ylim=</code><code class="functions">c</code><code class="plain">(yLower, yUpper), xlab=</code><code class="keyword">NA</code><code class="plain">, ylab=</code><code class="keyword">NA</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(smoothData[,1])) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">colindex &lt;- </code><code class="functions">floor</code><code class="plain">( (nColors-2) * ( (maxRow - </code><code class="functions">sum</code><code class="plain">(smoothData[i,])) / rowSpan ) ) + 1</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">polygon</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(1:</code><code class="functions">length</code><code class="plain">(smoothData[i,]), </code><code class="functions">length</code><code class="plain">(smoothData[i,]):1), </code><code class="functions">c</code><code class="plain">(smoothData[i,] + yOffset, </code><code class="functions">rev</code><code class="plain">(yOffset)), col=colors[colindex], border=</code><code class="string">"#ffffff"</code><code class="plain">, lwd=0.2)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">yOffset &lt;- yOffset + smoothData[i,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>You get a graph similar to the above, but now you get smooth layers.</p>
<p><span class="tip">A streamgraph with smoothed layers using <code>spline()</code></span><img src="./A Variety of Area Charts with R_files/05Streamgraph.png" alt="" title="Streamgraph" class="alignnone size-full wp-image-25523" width="625" height="337" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2012/07/05Streamgraph.png?resize=625%2C337" scale="2"></p>
<p>Nice.</p>
<p>Just for a peak under the hood of what's going on here. This is what the spline data looks like without filled colors.</p>
<p><span class="tip">Wireframe of previous streamgraph</span><img src="./A Variety of Area Charts with R_files/06Streamgraph-wireframe.png" alt="" title="Streamgraph wireframe" class="alignnone size-full wp-image-25524" width="625" height="336" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/07/06Streamgraph-wireframe.png?resize=625%2C336" scale="2"></p>
<h2>Putting it in a Function</h2>
<p>That's it. Of course, the whole point of this is so that you can use this code with other data as it comes along. You can hack at the script you've written so far, but it's much easier to wrap it up in a function. When you have a dataset, you can just plug it in. </p>
<p><span class="tip">The <code>areaGraph()</code> function takes three arguments, <code>thedata</code>, <code>type</code> (0=stacked area, 1=ThemeRiver, 2=streamgraph), and <code>smooth</code>. It also assumes a populated rectangular data frame.</span>See areagraph.R for how it's done. Most of the code is the same, except now you can just source the code into R and provide values to <code>areaGraph()</code>. </p>
<p>For example, you can make a smooth stacked area chart.</p>
<div id="highlighter_454724" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_454724_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_454724" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">source</code><code class="plain">(</code><code class="string">"areagraph.R"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="comments"># Juvenile arrests for drug possession</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">arrests &lt;- </code><code class="functions">read.table</code><code class="plain">(</code><code class="string">"data/juvenile-arrests-drugs.txt"</code><code class="plain">, header=</code><code class="keyword">TRUE</code><code class="plain">, row.names=1, sep=</code><code class="string">","</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">areaGraph</code><code class="plain">(arrests, type=0)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p><span class="tip">Stacked area chart with smoothed layers, using brand-spanking new function; applied to juvenile arrests data</span><img src="./A Variety of Area Charts with R_files/07Area-graph-sample-usage-arrests.png" alt="" title="Area graph sample usage - arrests" class="alignnone size-medium wp-image-25525" width="625" height="350" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2012/07/07Area-graph-sample-usage-arrests.png?resize=625%2C350" scale="2"></p>
<p>You can also make a streamgraph just as easily. </p>
<div id="highlighter_986571" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_986571_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_986571" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Internet access via broadband and dial-up </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">broadband &lt;- </code><code class="functions">read.table</code><code class="plain">(</code><code class="string">"data/broadband.txt"</code><code class="plain">, header=</code><code class="keyword">TRUE</code><code class="plain">, row.names=1, sep=</code><code class="string">","</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">areaGraph</code><code class="plain">(broadband, type=2)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p><span class="tip">Streamgraph offset applied to Internet access data</span><img src="./A Variety of Area Charts with R_files/08Area-graph-sample-internet.png" alt="" title="Area graph sample - internet" class="alignnone size-medium wp-image-25526" width="625" height="359" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/07/08Area-graph-sample-internet.png?resize=625%2C359" scale="2"></p>
<p>Maybe you don't want smooth. You can do that too.</p>
<div id="highlighter_482969" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_482969_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_482969" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Twitter data via search</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">par</code><code class="plain">(mfrow=</code><code class="functions">c</code><code class="plain">(3,1), mar=</code><code class="functions">c</code><code class="plain">(5,5,2,2))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">tweets &lt;- </code><code class="functions">read.table</code><code class="plain">(</code><code class="string">"data/tweets.txt"</code><code class="plain">, header=</code><code class="keyword">TRUE</code><code class="plain">, row.names=1, sep=</code><code class="string">","</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">areaGraph</code><code class="plain">(tweets, type=0, smooth=</code><code class="keyword">FALSE</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">areaGraph</code><code class="plain">(tweets, type=0)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="functions">areaGraph</code><code class="plain">(tweets, type=2)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p><span class="tip">Stacked area chart (top), smooth stacked area chart (middle), and streamgraph for tweet data.</span><img src="./A Variety of Area Charts with R_files/09Streamgraph-sample-usage-tweets.png" alt="" title="Streamgraph sample usage - tweets" class="alignnone size-medium wp-image-25527" width="625" height="565" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/07/09Streamgraph-sample-usage-tweets.png?resize=625%2C565" scale="2"></p>
<h2>Wrapping Up</h2>
<p>Area charts aren't the best solution for a lot of data, but for the right dataset, they could be a good fit. Plus, with an easy-to-use function, it doesn't take much time to produce them now, so there isn't much to lose. Want to expand the functionality? How about some code to add labels to layers? Or you could add a color argument to the main function so that you can easily change the look. </p>
<div class="clear-line"></div>
</div> 
</div> 
<div class="clear-line"></div>
<div id="end"></div>
 
<span id="comments"></span>
<div style="width:625px">
<div id="comments-block">
<h2>7 Comments</h2>
<ul class="commentlist">
<li class="comment byuser comment-author-johnathomp even thread-even depth-1" id="li-comment-131415">
<div id="comment-131415" class="">
<div class="avatar">
<img alt="" src="./A Variety of Area Charts with R_files/98bb54fa1442d2191fae381cde168012" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/98bb54fa1442d2191fae381cde168012?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">John Thompson</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#comment-131415">July 23, 2012 at 7:56 am</a>
</span>
</div>
<div class="comment-text"><p>Hello Nathan,</p>
<p>Excellent tutorial as usual!!!</p>
<p>I have a novice question about the initial code for polygon() used to draw the first area plot.</p>
<p>What is the logic behind creating a x argument that goes from 1 to 20 to 1 and subsequently in the y argument adding an additional 20 zeros. I can see the difference in the plots when those two features are excluded. I just don’t understand why they work</p>
<p>polygon(c(1:length(fakeData[1,]), length(fakeData[1,]):1), c(fakeData[1,], rep(0, length(fakeData[1,]))), col=”#cccccc”, border=”white”)</p>
<p>Thank,<br>
John</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nathany bypostauthor odd alt depth-2" id="li-comment-131563">
<div id="comment-131563" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./A Variety of Area Charts with R_files/a61decc5c78c05770cb107e4c5cbbb33" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/a61decc5c78c05770cb107e4c5cbbb33?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#comment-131563">July 24, 2012 at 10:02 am</a>
</span>
</div>
<div class="comment-text"><p>@John – Good question. The key here is the order that <code>polygon()</code> draws. It starts at the first (x, y) point, which is the first number from the x argument, and the first number from the y argument. In this case, that’s 1 and the first number from <code>fakeData</code>, respectively.</p>
<p>Then it moves on to the next point, so on and so forth. So here, we start from the left, make our way up and to the right, and then come back around to where we started to draw all sides of the layer in the area chart.</p>
<p>Another way to think about it is if you tried drawing one of the layers in the area chart with pencil and paper, without ever lifting the pencil. You start at one point and make your way around.</p>
<p>Hope that helps!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment byuser comment-author-jkradddic even thread-odd thread-alt depth-1" id="li-comment-141314">
<div id="comment-141314" class="">
<div class="avatar">
<img alt="" src="./A Variety of Area Charts with R_files/a7a60f7982511de0a8f8c18d9cf11876" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/a7a60f7982511de0a8f8c18d9cf11876?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Jane Kelly</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#comment-141314">August 13, 2012 at 8:44 am</a>
</span>
</div>
<div class="comment-text"><p>Has anyone been successful in adding labels and color guidelines? I havent been able to figure either out.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nathany bypostauthor odd alt depth-2" id="li-comment-141350">
<div id="comment-141350" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./A Variety of Area Charts with R_files/a61decc5c78c05770cb107e4c5cbbb33" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/a61decc5c78c05770cb107e4c5cbbb33?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#comment-141350">August 13, 2012 at 9:58 am</a>
</span>
</div>
<div class="comment-text"><p>@Jane – What kind of labels are you trying to add? You can always use the <code>text()</code> function for labels inside the plot, and you can use <code>mtext()</code> for labels outside.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment byuser comment-author-dconlon even thread-even depth-1" id="li-comment-146163">
<div id="comment-146163" class="">
<div class="avatar">
<img alt="" src="./A Variety of Area Charts with R_files/8c612bb6fccc1d123cf22a70c60f20f9" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/8c612bb6fccc1d123cf22a70c60f20f9?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Declan Conlon</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#comment-146163">August 21, 2012 at 12:50 am</a>
</span>
</div>
<div class="comment-text"><p>My initial suggestion would be recast this such that the plot takes columnar data, for the main reason that R is substantially faster at processing columnar data(my initial measurements on a reasonably big dataset show an order of magnitude improvement).<br>
Also, I’m not sure about anyone else but all of my data comes from csv/tsv style dumps so having this take columnar data would probably save a bunch of data manipulation in the majority of cases.<br>
Another point is your smoothing factor is hardcoded and not proportional to the amount of data.<br>
Nice tutorial, there is definitely a decent R library waiting to come out of this. Are there any plans to work on a library? or even would you be willing to let/help/collaborate with someone to create a library based on this?</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nathany bypostauthor odd alt depth-2" id="li-comment-146379">
<div id="comment-146379" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./A Variety of Area Charts with R_files/a61decc5c78c05770cb107e4c5cbbb33" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/a61decc5c78c05770cb107e4c5cbbb33?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#comment-146379">August 21, 2012 at 9:12 am</a>
</span>
</div>
<div class="comment-text"><p>@Declan – Thanks for the advice. For visualization, I like to get it to work first and optimize later, if I run into problems. It seems to work out okay most of the time, but any bits I can pick up along the way, then all the better. </p>
<p>I do eventually plan to wrap my R tutorial code into a package, so that could be a good time to tidy things up. If someone wanted to help me get started, I wouldn’t complain :).</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment byuser comment-author-brianjdoherty even thread-odd thread-alt depth-1" id="li-comment-155064">
<div id="comment-155064" class="">
<div class="avatar">
<img alt="" src="./A Variety of Area Charts with R_files/a99fe541c18e6d84f412296f6270a51e" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/a99fe541c18e6d84f412296f6270a51e?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Brian Doherty</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/07/03/a-variety-of-area-charts-with-r/#comment-155064">September 3, 2012 at 6:21 pm</a>
</span>
</div>
<div class="comment-text"><p>A bug-fix, and a question. First, in line 103 of streamprocess.R, you have “numcols” when you should have “numCols”. Second, I’m puzzled by the output of the area graph example. The y-axis looks OK, but the x-axis seems to bear no relationship to the arrest data. The data is annual, 2003 to 2009; shouldn’t those be the x-axis labels? At least I expected to see integers corresponding to the years: 1,2,3 … Where does 0 to 200 come from? I know I could dive into the code and figure this out, but can you point me in the right direction? Thanks.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul>
</div> 
</div>
</div>
</div> 
</div> 
</div> 
<div id="footer">
<div id="footer-container" class="content">
<div class="float-left" style="width:32%;margin-right:5%;">
<div id="about" class="sec">
<h3>About</h3>
<p>FlowingData explores how designers, statisticians, and computer scientists are using data to understand ourselves better — mainly through data visualization.</p>
<p>As for me, I'm Nathan Yau, and I have a PhD in statistics, with a background in eating.</p>
<p><a href="http://flowingdata.com/about/">More...</a></p>
</div>
</div>
<div class="float-left" style="width:36%;margin-right:5%;">
<div id="book-single" class="sec">
<h3>Books</h3>
<ul id="books" style="margin-bottom:0">
<li>
<a href="http://flowingdata.com/data-points/"><img src="./A Variety of Area Charts with R_files/DataPoints60x75.png" title="Data Points" class="img-left" style="margin-bottom:0" scale="0"><strong>Data Points</strong><br>Visualization that Means Something</a><br>
<div class="clear-line"></div>
</li>
<li><a href="http://flowingdata.com/visualize-this/"><img src="./A Variety of Area Charts with R_files/flowingdata60x79.jpg" title="Visualize This" class="img-left" style="margin-bottom:0" scale="0"><strong>Visualize This</strong><br>The FlowingData Guide to Design, Visualization, and Statistics</a><br>
<div class="clear-line"></div>
</li>
</ul>
</div> 
</div>
<div class="float-left" style="width:22%">
<div id="follow" class="sec">
<h3>Follow</h3>
<p>
<a href="http://twitter.com/flowingdata">Twitter</a> &nbsp;•&nbsp;
<a href="http://facebook.com/flowingdata">Facebook</a> &nbsp;•&nbsp;
<a href="http://eepurl.com/icL0o">Email</a> &nbsp;•&nbsp;
<a href="http://flowingdata.com/feed">RSS</a>
</p>
</div>
<div id="misc" class="sec">
<h3>Miscellaneous</h3>
<a href="http://flowingdata.com/contact">Contact</a> &nbsp;•&nbsp;
<a href="http://flowingdata.com/advertise">Sponsorship</a> &nbsp;•&nbsp;
<a href="http://flowingdata.bigcartel.com/">Shop</a><a>
</a></div><a>
</a></div><a>
<div class="clear-line"></div>
</a></div><a> 
</a></div><a> 
</a><div id="bottom"><a>
Unless otherwise noted, graphics and words by me are licensed under </a><a href="http://creativecommons.org/licenses/by-nc/3.0/us/">Creative Commons BY-NC</a>. Contact original authors for everything else.
</div>
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./A Variety of Area Charts with R_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-865100-4");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script type="text/javascript" src="./A Variety of Area Charts with R_files/shCore.js"></script>
<script type="text/javascript" src="./A Variety of Area Charts with R_files/shBrushR.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shCore.css?ver=2.1.364";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shThemeDefault.css?ver=2.1.364";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.clipboardSwf = 'http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = 'view source';
	SyntaxHighlighter.config.strings.copyToClipboard = 'copy to clipboard';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = 'The code is in your clipboard now';
	SyntaxHighlighter.config.strings.print = 'print';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./A Variety of Area Charts with R_files/photon.js"></script>
<script type="text/javascript" src="./A Variety of Area Charts with R_files/devicepx-jetpack.js"></script>
<script src="./A Variety of Area Charts with R_files/e-201350.js" type="text/javascript"></script>
<script type="text/javascript">
	st_go({v:'ext',j:'1:2.7',blog:'1938889',post:'25515',tz:'-8'});
	var load_cmc = function(){linktracker_init(1938889,25515,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script><img id="wpstats" src="./A Variety of Area Charts with R_files/g.gif" alt="" scale="0">
</body><style type="text/css">embed[type*="application/x-shockwave-flash"],embed[src*=".swf"],object[type*="application/x-shockwave-flash"],object[codetype*="application/x-shockwave-flash"],object[src*=".swf"],object[codebase*="swflash.cab"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"],object[classid*="d27cdb6e-ae6d-11cf-96b8-444553540000"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"]{	display: none !important;}</style></html>